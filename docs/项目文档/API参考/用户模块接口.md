# 用户模块接口

## 1. 接口概述

用户模块提供了用户注册、登录、信息管理等功能的API接口。

### 1.1 基础URL

```
https://api.example.com/v1/users
```

### 1.2 认证方式

- **Token认证**：所有接口（除了注册和登录）需要在请求头中携带`Authorization: Bearer <token>`
- **API Key**：部分接口支持API Key认证

## 2. 用户注册

### 2.1 接口说明

创建新用户账号。

### 2.2 请求信息

- **URL**：`/register`
- **方法**：`POST`
- **Content-Type**：`application/json`

### 2.3 请求参数

| 参数名 | 类型 | 必填 | 描述 | 示例 |
|--------|------|------|------|------|
| username | string | ✅ | 用户名，长度3-20字符 | `testuser` |
| email | string | ✅ | 邮箱地址 | `test@example.com` |
| password | string | ✅ | 密码，长度6-20字符 | `Password123` |
| nickname | string | ❌ | 昵称 | `测试用户` |
| avatar | string | ❌ | 头像URL | `https://example.com/avatar.jpg` |

### 2.4 请求示例

```json
{
  "username": "testuser",
  "email": "test@example.com",
  "password": "Password123",
  "nickname": "测试用户"
}
```

### 2.5 响应信息

#### 2.5.1 成功响应

- **状态码**：`201 Created`
- **响应体**：

```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "id": "123456",
    "username": "testuser",
    "email": "test@example.com",
    "nickname": "测试用户",
    "avatar": null,
    "created_at": "2023-12-01T10:00:00Z",
    "updated_at": "2023-12-01T10:00:00Z"
  }
}
```

#### 2.5.2 失败响应

- **状态码**：`400 Bad Request`
- **响应体**：

```json
{
  "code": 400,
  "message": "用户名已存在",
  "data": null
}
```

## 3. 用户登录

### 3.1 接口说明

用户登录，获取访问令牌。

### 3.2 请求信息

- **URL**：`/login`
- **方法**：`POST`
- **Content-Type**：`application/json`

### 3.3 请求参数

| 参数名 | 类型 | 必填 | 描述 | 示例 |
|--------|------|------|------|------|
| username | string | ✅ | 用户名或邮箱 | `testuser` |
| password | string | ✅ | 密码 | `Password123` |
| remember | boolean | ❌ | 是否记住登录 | `true` |

### 3.4 请求示例

```json
{
  "username": "testuser",
  "password": "Password123",
  "remember": true
}
```

### 3.5 响应信息

#### 3.5.1 成功响应

- **状态码**：`200 OK`
- **响应体**：

```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_at": "2023-12-08T10:00:00Z",
    "user": {
      "id": "123456",
      "username": "testuser",
      "email": "test@example.com",
      "nickname": "测试用户",
      "avatar": null
    }
  }
}
```

#### 3.5.2 失败响应

- **状态码**：`401 Unauthorized`
- **响应体**：

```json
{
  "code": 401,
  "message": "用户名或密码错误",
  "data": null
}
```

## 4. 获取用户信息

### 4.1 接口说明

获取当前登录用户的详细信息。

### 4.2 请求信息

- **URL**：`/profile`
- **方法**：`GET`
- **Authorization**：`Bearer <token>`

### 4.3 响应信息

#### 4.3.1 成功响应

- **状态码**：`200 OK`
- **响应体**：

```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "id": "123456",
    "username": "testuser",
    "email": "test@example.com",
    "nickname": "测试用户",
    "avatar": null,
    "bio": "这是一个测试用户",
    "phone": null,
    "created_at": "2023-12-01T10:00:00Z",
    "updated_at": "2023-12-01T10:00:00Z"
  }
}
```

#### 4.3.2 失败响应

- **状态码**：`401 Unauthorized`
- **响应体**：

```json
{
  "code": 401,
  "message": "令牌已过期",
  "data": null
}
```

## 5. 更新用户信息

### 5.1 接口说明

更新当前登录用户的信息。

### 5.2 请求信息

- **URL**：`/profile`
- **方法**：`PUT`
- **Content-Type**：`application/json`
- **Authorization**：`Bearer <token>`

### 5.3 请求参数

| 参数名 | 类型 | 必填 | 描述 | 示例 |
|--------|------|------|------|------|
| nickname | string | ❌ | 昵称 | `新昵称` |
| avatar | string | ❌ | 头像URL | `https://example.com/new-avatar.jpg` |
| bio | string | ❌ | 个人简介 | `这是我的新简介` |
| phone | string | ❌ | 手机号码 | `13800138000` |

### 5.4 请求示例

```json
{
  "nickname": "新昵称",
  "bio": "这是我的新简介"
}
```

### 5.5 响应信息

#### 5.5.1 成功响应

- **状态码**：`200 OK`
- **响应体**：

```json
{
  "code": 200,
  "message": "更新成功",
  "data": {
    "id": "123456",
    "username": "testuser",
    "email": "test@example.com",
    "nickname": "新昵称",
    "avatar": null,
    "bio": "这是我的新简介",
    "phone": null,
    "created_at": "2023-12-01T10:00:00Z",
    "updated_at": "2023-12-01T11:00:00Z"
  }
}
```

## 6. 更改密码

### 6.1 接口说明

更改当前登录用户的密码。

### 6.2 请求信息

- **URL**：`/change-password`
- **方法**：`POST`
- **Content-Type**：`application/json`
- **Authorization**：`Bearer <token>`

### 6.3 请求参数

| 参数名 | 类型 | 必填 | 描述 | 示例 |
|--------|------|------|------|------|
| old_password | string | ✅ | 旧密码 | `OldPassword123` |
| new_password | string | ✅ | 新密码 | `NewPassword123` |
| confirm_password | string | ✅ | 确认新密码 | `NewPassword123` |

### 6.4 请求示例

```json
{
  "old_password": "OldPassword123",
  "new_password": "NewPassword123",
  "confirm_password": "NewPassword123"
}
```

### 6.5 响应信息

#### 6.5.1 成功响应

- **状态码**：`200 OK`
- **响应体**：

```json
{
  "code": 200,
  "message": "密码更改成功",
  "data": null
}
```

#### 6.5.2 失败响应

- **状态码**：`400 Bad Request`
- **响应体**：

```json
{
  "code": 400,
  "message": "旧密码错误",
  "data": null
}
```

## 7. 退出登录

### 7.1 接口说明

用户退出登录，使当前令牌失效。

### 7.2 请求信息

- **URL**：`/logout`
- **方法**：`POST`
- **Authorization**：`Bearer <token>`

### 7.3 响应信息

#### 7.3.1 成功响应

- **状态码**：`200 OK`
- **响应体**：

```json
{
  "code": 200,
  "message": "退出登录成功",
  "data": null
}
```

## 8. 错误码说明

| 错误码 | 描述 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权，令牌无效或过期 |
| 403 | 禁止访问，没有权限 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |
| 1001 | 用户名已存在 |
| 1002 | 邮箱已被注册 |
| 1003 | 用户名或密码错误 |
| 1004 | 令牌已过期 |
| 1005 | 旧密码错误 |
| 1006 | 两次输入的密码不一致 |

## 9. 接口限流

- 注册接口：10次/分钟/IP
- 登录接口：10次/分钟/IP
- 其他接口：60次/分钟/用户

## 10. 最佳实践

1. **令牌管理**
   - 将令牌存储在安全的地方，避免泄露
   - 定期更换令牌
   - 令牌过期后重新登录获取新令牌

2. **请求频率**
   - 合理控制请求频率，避免触发限流
   - 对于频繁调用的接口，考虑缓存机制

3. **错误处理**
   - 合理处理各种错误码
   - 给用户友好的错误提示
   - 记录错误日志便于排查

4. **安全性**
   - 不要在URL中传递敏感信息
   - 使用HTTPS协议
   - 对敏感数据进行加密处理